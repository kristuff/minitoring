var Minitoring=Minitoring||{};Minitoring.Setup={start:function(){document.querySelector("#db-select").addEventListener("change",Minitoring.Setup.checkserverIdentVisiblity,!1);var n=new Minikit.Wizard(document.querySelector(".wizard"));n.onIndexChanged(function(e){var t=(e.detail.newIndex+1)/e.detail.total*100;n.html.querySelector(".wizard-progress-inner").style.width=t+"%";var r=n.html.querySelector(".wizard-button-next").getAttribute("data-next-text");switch(e.detail.newIndex){case 0:break;case 1:Minitoring.Setup.checkForInstall();break;case 2:Minitoring.Setup.checkDatabaseType();break;case 3:Minitoring.Setup.checkDatabaseCredentials();break;case 4:Minitoring.Setup.checkAdminCredentials();break;case 5:r=n.html.querySelector(".wizard-button-next").getAttribute("data-install-text");break;case 6:n.html.querySelector(".wizard-button-prev").style.display="none",r=n.html.querySelector(".wizard-button-next").getAttribute("data-close-text"),Minitoring.Setup.install()}n.html.querySelector(".wizard-button-next").innerHTML=r}),n.onClosed(function(){location.reload()}),n.index(0),document.querySelector(".wizard-overlay").classList.add("active")},languageChanged:function(){var e=document.querySelector("select#language-select").value,t=document.querySelector("body").getAttribute("data-language");e&&t!=e&&(window.location.href=window.location.origin+"/setup?language="+e)},checkDatabaseType:function(){},checkDatabaseCredentials:function(){},checkAdminCredentials:function(){},checkForInstall:function(){var e=document.querySelector("select#language-select").value,e="?requestDate="+(new Date).getTime()+"&language="+e;document.querySelector("#check-list").innerHTML="",document.querySelector("#check-result").innerHTML="",Minikit.ajax({url:window.location.origin+"/setup/check"+e,method:"GET",callback:function(e){if(200===e.status){var t=JSON.parse(e.responseText),r=Minikit.Alerts.create(t.message,{type:"success"});document.querySelector("#check-result").appendChild(r)}else{for(var n="",t=JSON.parse(e.responseText),a=0;a<t.errors.length;a++)n+="<br> -> "+t.errors[a].message;r=Minikit.Alerts.create(t.message+n,{type:"error"});document.querySelector("#check-result").appendChild(r)}},errCallback:function(){alert("TODO")}})},checkserverIdentVisiblity:function(){var e=document.getElementById("db-select").value;"mysql"==e||"pgsql"==e?(document.querySelector("#server-idents").classList.add("active"),document.querySelector("#db-idents").classList.add("active")):(document.querySelector("#server-idents").classList.remove("active"),document.querySelector("#db-idents").classList.remove("active"))},install:function(){document.querySelector("#install-loader").classList.add("active");var e=document.querySelector("select#language-select").value,t=document.getElementById("db_name").value,r=document.getElementById("admin_name").value,n=document.getElementById("admin_email").value,a=document.getElementById("admin_password").value;Minikit.ajax({url:window.location.origin+"/setup/install",data:"admin_name="+r+"&admin_email="+n+"&admin_password="+a+"&db_name="+t+"&language="+e,method:"POST",callback:function(e){if(document.querySelector("#install-loader").classList.remove("active"),200===e.status){var t=JSON.parse(e.responseText),r=Minikit.Alerts.create(t.message,{type:"success"});document.querySelector("#install-result").appendChild(r)}else{for(var n="",t=JSON.parse(e.responseText),a=0;a<t.errors.length;a++)n+="<br> -> "+t.errors[a].message;r=Minikit.Alerts.create("Oops! Something was wrong somewhere..."+n,{type:"error"});document.querySelector("#install-result").appendChild(r)}},errCallback:function(){var e=Minikit.Alerts.create("Oops! Something was wrong somewhere...",{type:"error"});document.querySelector("#install-loader").classList.remove("active"),document.querySelector("#install-result").appendChild(e)}})}},Minikit.ready(function(){Minitoring.Setup.start()});